{% extends "layout.html" %}

{% block content %}
<div class="container-fluid">
    <h1 class="my-4 text-center" style="color: #6a1b9a;">Phone Number Validation</h1>
    <p class="text-center" style="color: #333;">Validate phone numbers to ensure they are active and reachable for your outreach efforts.</p>

    <!-- Phone Number Validation Form -->
    <form id="phone-validation-form" class="d-flex flex-column align-items-center mb-5" method="POST" action="{{ url_for('phone_validation') }}" style="max-width: 800px; margin: auto;">
        <div class="mb-3 w-100">
            <label for="phone-numbers" class="form-label" style="color: #6a1b9a;">Phone Numbers</label>
            <textarea id="phone-numbers" name="phone_numbers" class="form-control rounded-lg shadow-sm" rows="8" placeholder="Enter phone numbers, one per line:e.g, +1 415-555-2671" style="border: 2px solid #6a1b9a;" required></textarea>
        </div>

        <button id="validate-button" class="btn btn-purple rounded-lg mt-3 shadow-lg" type="submit" style="background-color: #8e24aa; color: #ffffff; width: 100%; max-width: 200px;">
            <i class="fas fa-check"></i> Validate Numbers
        </button>
    </form>

    <!-- Results Section -->
    <div id="validation-results" class="card shadow-lg mx-auto" style="max-width: 800px; border-radius: 15px; border: 2px solid #8e24aa;">
        <div class="card-body">
            <h5 class="card-title text-center" style="color: #8e24aa;">Validation Results</h5>
            <hr>
            <ul class="list-group list-group-flush" id="results-list" style="max-height: 300px; overflow-y: auto;">
                <!-- Results will be populated here dynamically -->
            </ul>
        </div>
    </div>
</div>

<style>
    #phone-validation-form {
        border-radius: 10px;
        border: 2px solid #8e24aa;
        padding: 20px;
        background-color: #f9f9f9;
    }

    #phone-validation-form:hover {
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15); /* Deepened shadow */
        transform: translateY(-5px); /* Floating effect */
    }

    #validation-results {
        margin-top: 20px;
    }

    .form-control {
        border-radius: 8px;
    }

    .btn-purple {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .btn-purple:hover {
        transform: translateY(-3px); /* Floating effect */
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2); /* Deepened shadow */
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const phoneValidationForm = document.getElementById('phone-validation-form');
        const validateButton = document.getElementById('validate-button');
        const resultsList = document.getElementById('results-list');

        phoneValidationForm.addEventListener('submit', (event) => {
            event.preventDefault();

            // Add spinner to button
            validateButton.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Validating...';
            validateButton.disabled = true;

            // Prepare form data for AJAX request
            const formData = new FormData(phoneValidationForm);

            // Simulate a random delay
            const delay = Math.floor(Math.random() * 2000) + 1000; // Random delay between 1-3 seconds

            setTimeout(() => {
                // Send the AJAX POST request to Flask route
                fetch('{{ url_for("phone_validation") }}', {
                    method: 'POST',
                    body: formData,
                })
                .then(response => response.json())
                .then(data => {
                    validateButton.innerHTML = '<i class="fas fa-check"></i> Validate Numbers';
                    validateButton.disabled = false;

                    resultsList.innerHTML = '';  // Clear loading indicator
                    // Populate results
                    data.forEach(result => {
                        const resultItem = document.createElement('li');
                        resultItem.className = 'list-group-item';
                        resultItem.innerHTML = `<strong style="color: #6a1b9a;">${result.number}</strong> - <span class="${result.status_class}">${result.status}</span>`;
                        resultsList.appendChild(resultItem);
                    });
                })
                .catch(error => {
                    validateButton.innerHTML = '<i class="fas fa-check"></i> Validate Numbers';
                    validateButton.disabled = false;

                    resultsList.innerHTML = `<li class="list-group-item text-danger">An error occurred: ${error}</li>`;
                });
            }, delay);
        });
    });
</script>

{% endblock %}
